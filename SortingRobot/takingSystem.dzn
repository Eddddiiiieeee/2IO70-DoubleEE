import interfaces.dzn;

interface ITaking {
	in void start();
	in void stop();
	out void error();
	
	enum State {Running, Stopped, ERROR};
	
	behaviour {
		State state = State.Stopped;
		
		[state.Stopped] {
			on start: {state = State.Running;}
			on stop: illegal;
		}
		[state.Running] {
			on start: illegal;
			on stop: {state = State.Stopped;}
			on optional: {error; state = State.ERROR;}
		}
		[state.ERROR] {
			on start: illegal;
			on stop: {state = State.Stopped;}
		}
	}
}

component TakingSystem {
	provides ITaking takingSystem;
	
	system {
		Taker taker;
		DiskDetector detector;
		Blocker blocker;
		
		takingSystem <=> taker.taker;
		taker.diskDetector <=> detector.diskDetector;
		taker.blockingPiston <=> blocker.piston;
	}
}

component Taker {
	provides ITaking taker;
	
	requires IPiston blockingPiston;
	requires IBasicSensor diskDetector;
}

component DiskDetector {
	provides IBasicSensor diskDetector;
}

// Replace with blocking system for error detection
component Blocker {
	provides IPiston piston;
}